---
legacyUrl: true
slug: 2022-08-11-text-with-accompanying-icon
title: 'テキストの行の末尾に付随するアイコンをアイコンだけで改行させないようにするCSS'
pubDate: 2022-08-11T20:25:00.000+09:00
---

import { Tweet } from 'astro-embed';
import { Image } from 'astro:assets';

テキストの行の末尾にアイコンを付随させるというレイアウトがある。

<figure>
  <Image
    src={import('./assets/text-with-accompanying-icon/1.png')}
    alt=""
    style="width: calc(716/2/16*1rem);"
  />
</figure>

これは、インライン整形コンテキストにおいてテキストとアイコンを並べて配置することで実現できる。

<figure>

```html
<a href="#"
  >テキストの行の末尾に付随するアイコンを…<svg><!-- ... --></svg></a
>
```

</figure>

しかし、その空間の大きさやテキストの分量によっては、末尾のアイコンだけが改行してしまって不恰好に見えることがある。

<figure>
  <Image
    src={import('./assets/text-with-accompanying-icon/2.png')}
    alt=""
    style="width: calc(780/2/16*1rem);"
  />
</figure>

そうした場合には、テキスト要素のパディングとアイコン要素のネガティブマージンを組み合わせることで対処できる。次のようにすると、アイコンだけが単独で改行されることがなく、常にテキストを伴って改行されるようになる。

<figure>

```html
<a class="card" href="#">
  <span class="card__label">テキストの行の末尾に付随するアイコンを…</span
  ><!--
	--><svg class="card__icon"><!-- ... --></svg>
</a>
```

</figure>

<figure>

```css
.card {
  --icon-size: 1em;
  --icon-margin: 0.25em;
}

.card__label {
  padding-right: calc(var(--icon-margin) + var(--icon-size));
}

.card__icon {
  margin-left: calc(var(--icon-size) * -1);
  width: var(--icon-size);
  height: var(--icon-size);
}
```

</figure>

<figure>
  <video controls playsinline style="width: calc(1560/2/16*1rem);">
    <source src={(await import('./assets/text-with-accompanying-icon/3.mp4')).default} />
  </video>
</figure>

まずテキスト要素の`padding-right`によって、アイコンとその間の余白を加えた分の空間が末尾に確保されるようになる。そしてその空間を埋めるように、アイコン要素の位置を`margin-left`のネガティブ値で移動させる。それによって、アイコンが必ずテキストの末尾に隣り合って配置されるようになる。

<figure>

```html demo title="テキストの行の末尾にアイコンが付随するレイアウト"
<style>
  :root {
    color-scheme: light;
  }

  body {
    margin: 1em;
    background-color: #eee;
  }

  hr {
    margin-top: 3em;
    margin-bottom: 3em;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1em;
  }

  .card {
    --icon-size: 1em;
    --icon-margin: 0.25em;
    border-radius: 4px;
    background-color: white;
    padding: 1em 1.25em;
    color: inherit;
    line-height: 1.5;
    text-decoration: none;
  }

  .card__label {
    padding-right: var(--icon-margin);
  }

  .card--improved .card__label {
    padding-right: calc(var(--icon-margin) + var(--icon-size));
  }

  .card__icon {
    vertical-align: -0.125em;
    fill: blue;
    width: var(--icon-size);
    height: var(--icon-size);
  }

  .card--improved .card__icon {
    margin-left: calc(var(--icon-size) * -1);
  }
</style>

<svg display="none">
  <symbol id="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
    <path
      d="M4.5 17q-.625 0-1.062-.438Q3 16.125 3 15.5v-11q0-.625.438-1.062Q3.875 3 4.5 3H10v1.5H4.5v11h11V10H17v5.5q0 .625-.438 1.062Q16.125 17 15.5 17Zm3.562-4L7 11.938 14.438 4.5H12V3h5v5h-1.5V5.562Z"
    />
  </symbol>
</svg>

<p>通常版:</p>

<div class="grid">
  <a class="card" href="#"
    ><span class="card__label">青い天鵞絨を張った腰掛け</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card" href="#"
    ><span class="card__label">銀河ステーションと言う声がしたというの</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card" href="#"
    ><span class="card__label">ごめんなさいジョバンニはまっすぐに立って</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card" href="#"
    ><span class="card__label">森の中からでもかおりだしたというふうにして</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card" href="#"
    ><span class="card__label">姿勢のまままた水の中へ</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card" href="#"
    ><span class="card__label">やって来るのを待っていました</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>
</div>

<hr />

<p>改良版:</p>

<div class="grid">
  <a class="card card--improved" href="#"
    ><span class="card__label">青い天鵞絨を張った腰掛け</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card card--improved" href="#"
    ><span class="card__label">銀河ステーションと言う声がしたというの</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card card--improved" href="#"
    ><span class="card__label">ごめんなさいジョバンニはまっすぐに立って</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card card--improved" href="#"
    ><span class="card__label">森の中からでもかおりだしたというふうにして</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card card--improved" href="#"
    ><span class="card__label">姿勢のまままた水の中へ</span
    ><!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>

  <a class="card card--improved" href="#"
    ><span class="card__label">やって来るのを待っていました</span>
    <!--
--><svg class="card__icon" viewBox="0 0 20 20"><use href="#icon" /></svg
  ></a>
</div>
```

</figure>

注意点としては、テキスト要素とアイコン要素の間にソースコード上でホワイトスペースが入らないようにすることだ。ホワイトスペースの分の幅ができると、アイコンのために確保した空間をはみ出してしまうため、改行方法が正しく制御されなくなる。

## 後日追記

<Tweet id="https://x.com/SaekiTominaga/status/1557902385376563202" />

テキスト要素に`margin-right`を使っていたら、Firefoxでこのような問題が起こってしまった。代わりに、`padding-right`に差し替えると直った。理由はよくわからない……。

---

<blockquote>
  <p lang="ja" dir="ltr">
    パディング領域よりアイコンの大きさが小さいと、まれに右下のようにアイコンが飛び出すっぽかった（ラベルの最後の文字に依存しそう）{' '}
    <a href="https://t.co/eT03xm8Eq0">pic.x.com/eT03xm8Eq0</a>
  </p>
  <p>
    &mdash; ながしまきょう (@hail2u_){' '}
    <a href="https://x.com/hail2u_/status/1557858922454974464?ref_src=twsrc%5Etfw">
      August 11, 2022
    </a>
  </p>
</blockquote>

これは直し方がわからなかった……。

---

アイコンのために`svg`要素やあるいは擬似要素を使う代わりに、テキスト要素の`background-image`を使うとより安全だけど、その場合はアイコンの高さを`1em`より大きくすることができないという制約がある。

## 2025年1月7日追記

`text-wrap`プロパティを利用することで、アイコンだけで改行させないテクニックが紹介されていた。

[CSS fix to prevent orphan icons dropping to a new line · Muffin Man](https://muffinman.io/blog/css-fix-to-prevent-orphan-icons/)
