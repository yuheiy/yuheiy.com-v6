---
import { getCollection } from 'astro:content';
import DateTime from '#components/DateTime.astro';
import PageHeader from '#components/PageHeader.astro';
import PageNav from '#components/PageNav.astro';
import Teaser from '#components/Teaser.astro';
import Layout from '#layouts/Layout.astro';
import { getBlogDescription } from '#lib/blog';
import { blogPath } from '#paths';

const title = 'ブログ';
const description = 'ウェブデザインやフロントエンドに関する雑記。';

const items = await Promise.all(
  (await getCollection('blog'))
    .toSorted((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .map(async (entry) => ({
      title: entry.data.title,
      link: blogPath(entry),
      date: entry.data.pubDate,
      description: await getBlogDescription(entry),
    })),
);
---

<Layout title={title} description={description}>
  <PageNav />
  <PageHeader title={title} description={description} />

  <main>
    {
      items.map(({ date, ...item }) => (
        <Teaser headingLevel={2} {...item}>
          <DateTime slot="meta" date={date} />
        </Teaser>
      ))
    }
  </main>
</Layout>
