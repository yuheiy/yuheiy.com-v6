---
import type { CollectionEntry } from 'astro:content';
import { getCollection, getEntry } from 'astro:content';
import DetailsList from '../components/DetailsList.astro';
import type { DetailsListItem } from '../components/DetailsList.astro';
import PageHeader from '../components/PageHeader.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import Layout from '../layouts/Layout.astro';
import { renderDateHtml, renderProjectDateRangeHtml } from '../lib/date-time-formatter';

const everylayoutEntry = await getEntry('blog', '20211011-publication-of-everylayout');

const primaryEntries = [
  {
    title: 'Tailwind CSS実践入門 ～まず作ってから、あとで共通化する',
    link: 'https://gihyo.jp/list/group/Tailwind-CSS%E5%AE%9F%E8%B7%B5%E5%85%A5%E9%96%80-%EF%BD%9E%E3%81%BE%E3%81%9A%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%8B%E3%82%89-%E3%81%82%E3%81%A8%E3%81%A7%E5%85%B1%E9%80%9A%E5%8C%96%E3%81%99%E3%82%8B',
    meta: 'gihyo.jp',
  },
  toPrimaryItem(await getEntry('blog', '2023-02-06-tailwind-css-in-wdpress')),
  toPrimaryItem(await getEntry('blog', '2022-11-03-how-to-understand-the-markup')),
  toPrimaryItem(await getEntry('blog', '2022-08-01-declarative-design')),
  toPrimaryItem(await getEntry('blog', '2022-06-11-css-components')),
  {
    title: '本文のタイポグラフィとCSS',
    link: 'https://paper.dropbox.com/doc/CSS--BiYi3PrpPiQ_4sOfqgvEMeAEAg-wPD007Sd9dSeEDLP78jri',
    meta: '社内発表',
  },
  {
    title: '『Every Layout』に到った背景と思想についての私の解釈',
    link: 'https://note.com/shiftbrain/n/n0a01726673e0',
    meta: 'SHIFTBRAIN note',
  },
  {
    title: '「Every Layout」をめぐる座談会',
    link: 'https://www.codegrid.net/series/2021-talk-about-every-layout',
    meta: 'CodeGrid',
  },
  toPrimaryItem(everylayoutEntry),
  toPrimaryItem(await getEntry('blog', '20210127-prefer-margin-top')),
  {
    title: 'Tailwind CSSの設計思想を業務に活かす',
    link: 'https://www.codegrid.net/series/2020-tailwind-talk',
    meta: 'CodeGrid',
  },
  {
    title:
      'CSSのユーティリティクラスと「関心の分離」&mdash;&mdash;いかにしてユーティリティファーストにたどり着いたか（翻訳）',
    link: 'https://yuheiy.hatenablog.com/entry/2020/05/25/021342',
    meta: 'yuhei blog',
  },
  {
    title: '制作者のためのHTML',
    link: 'https://yuheiy.github.io/html-for-creators/',
    meta: "<a href='https://ca11y.connpass.com/event/120003/'>CA11Y #1 〜アクセシビリティはじめて物語〜</a>",
  },
  {
    title: 'ページ内リンクの実装から考える、a要素のclickイベントとその振る舞い',
    link: 'https://standard.shiftbrain.com/blog/default-action-for-click-event-of-a-element',
    meta: 'シフトブレイン／スタンダードデザインユニット',
  },
] satisfies DetailsListItem[];

function toPrimaryItem(entry: CollectionEntry<'blog'>): DetailsListItem {
  return {
    title: entry.data.title,
    link: `/${entry.slug}`,
    meta: SITE_TITLE,
  };
}

const projects = [
  {
    title: 'sdenv',
    link: 'https://github.com/yuheiy/sdenv',
    meta: renderProjectDateRangeHtml('2023-07'),
    description:
      'ウェブサイト構築のためのベストプラクティスに基づいて構成された、Astro、Tailwind CSS、Alpine.jsを中心とした開発環境。',
  },
  {
    title: 'wordpress-starter',
    link: 'https://github.com/yuheiy/wordpress-starter',
    meta: renderProjectDateRangeHtml('2020-08', '2022-10'),
    description: 'WordPressテーマ構築のための開発環境。',
  },
  {
    title: 'accrefs',
    link: 'https://accrefs.jp/',
    meta: renderProjectDateRangeHtml('2019-09'),
    description:
      'ウェブアクセシビリティの参考資料をまとめたサイト。日本語の資料を中心にリンク数は200を超える。サイトのデザインおよび実装に携わる。有志のメンバーにより制作・運営されている。',
  },
  {
    title: 'shifted',
    link: 'https://github.com/yuheiy/shifted',
    meta: renderProjectDateRangeHtml('2019-05', '2023-07'),
    description: '静的サイト構築のための開発環境。',
  },
  {
    title: 'シフトブレイン／スタンダードデザインユニット',
    link: 'https://standard.shiftbrain.com/',
    meta: renderProjectDateRangeHtml('2018-10', '2020-06'),
    description: '自社で所属していたチームのウェブサイト。',
  },
  {
    title: 'yuhei blog',
    link: 'https://yuheiy.hatenablog.com/',
    meta: renderProjectDateRangeHtml('2015-10', '2020-11'),
    description: '過去に更新していた個人ブログ。',
  },
] satisfies DetailsListItem[];

const blogEntries = (await getCollection('blog')).toSorted(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<Layout isHome description={SITE_DESCRIPTION}>
  <PageHeader isHome title="安田 祐平">
    <div class="space-y-4 text-dynamic-muted [&_a:any-link]:text-dynamic">
      <p>{SITE_DESCRIPTION}</p>
      <p>
        監訳を担当した書籍『<a href={`/${everylayoutEntry.slug}`}
          >Every Layout&mdash;&mdash;モジュラーなレスポンシブデザインを実現するCSS設計論</a
        >』が<a href="https://www.hanmoto.com/bd/isbn/9784862465177">オンライン書店などで発売中</a
        >。
      </p>
    </div>
  </PageHeader>

  <main>
    <section class="wrapper">
      <h2 class="mb-12 text-lg font-bold leading-tight text-dynamic-muted">主な投稿</h2>

      <DetailsList items={primaryEntries} />
    </section>

    <div class="my-16 border-t"></div>

    <section class="wrapper">
      <h2 class="mb-12 text-lg font-bold leading-tight text-dynamic-muted">プロジェクト</h2>

      <DetailsList items={projects} />
    </section>

    <div class="my-16 border-t"></div>

    <section class="wrapper">
      <h2 class="mb-12 text-lg font-bold leading-tight text-dynamic-muted">最近のブログ</h2>

      <DetailsList
        items={blogEntries.slice(0, 3).map((entry) => ({
          title: entry.data.title,
          link: `/${entry.slug}`,
          meta: renderDateHtml(entry.data.pubDate),
        }))}
        ordered={true}
      />
    </section>
  </main>
</Layout>
